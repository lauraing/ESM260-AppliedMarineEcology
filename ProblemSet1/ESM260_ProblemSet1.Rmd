---
title: "ESM 260 - Problem Set 1"
author: "Laura Ingulsrud"
date: "1/26/2020"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}

# Load necessary packages
library(tidyverse)
library(sanzo)

```

```{r data, include=FALSE}

# Read in data
density <- read_csv("density_adultfish.csv")
density_other <- read_csv("density_other.csv")
recruited <- read_csv("recruited_fish.csv")

```

####1. Mean Density of Adult Fish

For data set I (Mean Density of Adults) compare and contrast changes in the Rarotongan and Aitutaki Lagoons since 2009. For each organism, make a histogram that displays the mean density of the organism (y-axis) at Rarotonga and Aitutaki for 2009 and for 2018. Add the 95% confidence intervals to each graph. In your narrative, state which organisms that showed a statistically significant difference in density between Rarotonga and Aitutaki, and which showed a statistically significant difference between 2009 and 2019. State what the trends are. For now, weâ€™ll adopt the convention that 2 means are statistically different if the mean of each is not included in the 95% confidence interval of the other mean.

```{r #1}

# Create bar charts for each organism that displays the mean density of the organism (y-axis) at Rarotonga and Aitutaki for 2009 and 2018. Add the 95% confidence intervals to each graph.

################# Surgeonfish #################

surgeonfish <- density %>% 
  filter(organism == "Surgeonfish")

surgeonfish_plot <- ggplot(surgeonfish, aes(x = location, y = density, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density - CI, ymax = density + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Adult Surgeonfish") +
  scale_y_continuous(expand = c(0,0), limits = c(-20,450), breaks = seq(0,400,100)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c074"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeonfish_plot  

################# Coral Trout #################

coraltrout <- density %>% 
  filter(organism == "Coral Trout")

coraltrout_plot <- ggplot(coraltrout, aes(x = location, y = density, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density - CI, ymax = density + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Adult Coral Trout") +
  scale_y_continuous(expand = c(0,0), limits = c(-20,200), breaks = seq(0,200,50)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c074"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coraltrout_plot

################# Spotted Damselfish #################

spotteddamselfish <- density %>% 
  filter(organism == "Spotted Damselfish")

spotteddamselfish_plot <- ggplot(spotteddamselfish, aes(x = location, y = density, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density - CI, ymax = density + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Adult Spotted Damselfish") +
  scale_y_continuous(expand = c(0,0), limits = c(-40,1000), breaks = seq(0,1000,200)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c074"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotteddamselfish_plot

################# Yellow Damselfish #################

yellowdamselfish <- density %>% 
  filter(organism == "Yellow Damselfish")

yellowdamselfish_plot <- ggplot(yellowdamselfish, aes(x = location, y = density, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density - CI, ymax = density + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Adult Yellow Damselfish") +
  scale_y_continuous(expand = c(0,0), limits = c(0,110), breaks = seq(0,100,20)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c074"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

yellowdamselfish_plot

################# Mounding Corals #################

moundingcoral <- density_other %>% 
  filter(organism == "Mounding Corals")

moundingcoral_plot <- ggplot(moundingcoral, aes(x = location, y = density_habitat, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density_habitat - CI, ymax = density_habitat + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Mounding Corals") +
  scale_y_continuous(expand = c(0,0), limits = c(0,25), breaks = seq(0,25,5)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c102"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

moundingcoral_plot

################# Coarse-branching Corals #################

coarsecoral <- density_other %>% 
  filter(organism == "Coarse-branching Corals")

coarsecoral_plot <- ggplot(coarsecoral, aes(x = location, y = density_habitat, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density_habitat - CI, ymax = density_habitat + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Coarse-branching Corals") +
  scale_y_continuous(expand = c(0,0), limits = c(0,4), breaks = seq(0,4,1)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c102"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coarsecoral_plot

################# Fine-branching Corals #################

finecoral <- density_other %>% 
  filter(organism == "Fine-branching Corals")

finecoral_plot <- ggplot(finecoral, aes(x = location, y = density_habitat, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density_habitat - CI, ymax = density_habitat + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Fine-branching Corals") +
  scale_y_continuous(expand = c(0,0), limits = c(-0.7,4.3), breaks = seq(0,4,1)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c102"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

finecoral_plot

################# Sea Anemones #################

anemone <- density_other %>% 
  filter(organism == "Sea Anemones")

anemone_plot <- ggplot(anemone, aes(x = location, y = density_habitat, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density_habitat - CI, ymax = density_habitat + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Sea Anemones") +
  scale_y_continuous(expand = c(0,0), limits = c(0,2), breaks = seq(0,2,0.5)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c102"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

anemone_plot

################# Algae #################

algae <- density_other %>% 
  filter(organism == "Algae")

algae_plot <- ggplot(algae, aes(x = location, y = density_habitat, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = density_habitat - CI, ymax = density_habitat + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Organisms~(per~100~m^2)),
    title = "Mean Density of Algae") +
  scale_y_continuous(expand = c(0,0), limits = c(-0.5,6.5), breaks = seq(0,6,2)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c102"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

algae_plot

```
There were significantly less adult Surgeonfish in Rarotonga compared to Aitutaki in both 2009 and 2018, although this difference is more drastic in 2018. In Rarotonga, adult Surgeonfish significantly decreased from 2009 to 2018.

There were significantly less adult Coral Trout in Rarotonga compared to Aitutaki in 2009. In Aitutaki and Rarotonga, adult Coral Trout significantly decreased from 2009 to 2018.

There were significantly less adult Spotted Damselfish in Rarotonga compared to Aitutaki in both 2009 and 2018. In Aitutaki and Rarotonga, adult Spotted Damselfish significantly decreased from 2009 to 2018.

In Aitutaki and Rarotonga, adult Yellow Damselfish significantly increased from 2009 to 2018. 


####2. Mean Density of Recruited Young Fish

Do the same as in Question 1 for the recruits (young) of each fish species.
```{r #2}

# Create bar charts for each recruit (young) of each fish species that displays the mean density of the organism (y-axis) at Rarotonga and Aitutaki for 2009 and 2018. Add the 95% confidence intervals to each graph.

################# Surgeonfish #################

surgeonfish_recruit <- recruited %>% 
  filter(fish == "Surgeonfish") %>% 
  filter(number != 0)

surgeonfish_recruit_plot <- ggplot(surgeonfish_recruit, aes(x = location, y = number, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = number - CI, ymax = number + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Fish~Recruits~(per~1~m^2~of~microhabitat)),
    title = "Mean Density of Recruited Surgeonfish") +
  scale_y_continuous(expand = c(0,0), limits = c(0,45), breaks = seq(0,45,10)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c047"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeonfish_recruit_plot  

################# Coral Trout #################

coraltrout_recruit <- recruited %>% 
  filter(fish == "Coral Trout") %>% 
  filter(number != 0)

coraltrout_recruit_plot <- ggplot(coraltrout_recruit, aes(x = location, y = number, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = number - CI, ymax = number + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Fish~Recruits~(per~1~m^2~of~microhabitat)),
    title = "Mean Density of Recruited Coral Trout") +
  scale_y_continuous(expand = c(0,0), limits = c(-1.6,15), breaks = seq(0,15,5)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c047"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coraltrout_recruit_plot  

################# Spotted Damselfish #################

spotted_recruit <- recruited %>% 
  filter(fish == "Spotted Damselfish") %>% 
  filter(number != 0)

spotted_recruit_plot <- ggplot(spotted_recruit, aes(x = location, y = number, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = number - CI, ymax = number + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Fish~Recruits~(per~1~m^2~of~microhabitat)),
    title = "Mean Density of Recruited Spotted Damselfish") +
  scale_y_continuous(expand = c(0,0), limits = c(0,21), breaks = seq(0,20,5)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c047"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotted_recruit_plot 

################# Yellow Damselfish #################

yellow_recruit <- recruited %>% 
  filter(fish == "Yellow Damselfish") %>% 
  filter(number != 0)

yellow_recruit_plot <- ggplot(yellow_recruit, aes(x = location, y = number, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  geom_errorbar(aes(ymin = number - CI, ymax = number + CI), position = position_dodge(0.9), width = 0.3) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Fish~Recruits~(per~1~m^2~of~microhabitat)),
    title = "Mean Density of Recruited Yellow Damselfish") +
  scale_y_continuous(expand = c(0,0), limits = c(0,52), breaks = seq(0,50,10)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c047"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

yellow_recruit_plot 

```
In Rarotonga, recruited Coral Trout significantly decreased from 2009 to 2018.

There were significantly more recruited Yellow Damselfish in Rarotonga compared to Aitutaki in both 2009 and 2018. In both Aitutaki and Rarotonga, recruited Yellow Damselfish significantly increased from 2009 to 2018.


####3. Density of Fish Recruits per 100m^2 Area of Reef

Use data sets I and II to calculate the density of fish recruits per 100 m2 area of reef. Note that the density of fish recruits is given as the number per 1 m2 of microhabitat, so you will need to figure out how to calculate the density of recruits per 100 m2 of reef area (not all of which is covered by the microhabitat occupied by the fish). For each fish species, make an XY Scatter plot to reveal the relationship between the density (per 100 m2 for reef area) of recruits and adults. Each place and time will be 1 data point, so each graph will have 4 data points. Add a linear trend line to each plot (select a graph, on Tool Bar press â€˜Insertâ€™ then â€˜Trendlineâ€™, select â€˜Trend/Regression Typeâ€™ = â€˜Linearâ€™, select options, check box â€˜Display R-square Value on Chartâ€™, press â€˜OKâ€™). Label the axes. Which species show correlations in adult and recruit densities and what are those relationships?

```{r #3}

# Multiply number of fish recruits per 1 m2 of microhabitat by the density of "other organisms" (microhabitat) per 100 m2 of reef area to get the density of fish recruits per 100 m2 of reef area

################# Surgeonfish (microhabitat = Fine-branching Coral) #################

surgeonfish_recruit_density <- (surgeonfish_recruit$number * finecoral$density_habitat)

surgeonfish_all <- cbind(surgeonfish_recruit_density, surgeonfish)

surgeonfish_r2 <- surgeonfish_all %>% 
  summarize(R2 = summary(lm(surgeonfish_recruit_density ~ density))$r.squared)
# R2 = 0.96754

# Create XY scatter plot of density of recruits and adults
surgeonfish_all_plot <- ggplot(surgeonfish_all, aes(
                                                    x = surgeonfish_recruit_density, 
                                                    y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Fish~Recruits~(per~100~m^2~of~reef~area)), 
    y = expression(Density~of~Adult~Fish~(per~100~m^2~of~reef~area)),
    title = expression(Density~of~Surgeonfish~Recruits~and~Adults~per~100~m^2~of~reef~area),
    color = "Lagoon",
    shape = "Year")+
  scale_color_manual(values = sanzo.duo("c091")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeonfish_all_plot

################# Coral Trout (microhabitat = Coarse-branching Coral) #################

coraltrout_recruit_density <- (coraltrout_recruit$number * coarsecoral$density_habitat)

coraltrout_all <- cbind(coraltrout_recruit_density, coraltrout)

coraltrout_r2 <- coraltrout_all %>% 
  summarize(R2 = summary(lm(coraltrout_recruit_density ~ density))$r.squared)
# R2 = 0.8957753

# Create XY scatter plot of density of recruits and adults
coraltrout_all_plot <- ggplot(coraltrout_all, aes(
                                                    x = coraltrout_recruit_density, 
                                                    y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Fish~Recruits~(per~100~m^2~of~reef~area)), 
    y = expression(Density~of~Adult~Fish~(per~100~m^2~of~reef~area)),
    title = expression(Density~of~Coral~Trout~Recruits~and~Adults~per~100~m^2~of~reef~area),
    color = "Lagoon",
    shape = "Year")+
  scale_color_manual(values = sanzo.duo("c091")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coraltrout_all_plot

################# Spotted Damselfish (microhabitat = Sea Anemones) #################

spotted_recruit_density <- (spotted_recruit$number * anemone$density_habitat)

spotted_all <- cbind(spotted_recruit_density, spotteddamselfish)

spotted_r2 <- spotted_all %>% 
  summarize(R2 = summary(lm(spotted_recruit_density ~ density))$r.squared)
# R2 = 0.9434432

# Create XY scatter plot of density of recruits and adults
spotted_all_plot <- ggplot(spotted_all, aes(
                                            x = spotted_recruit_density, 
                                            y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Fish~Recruits~(per~100~m^2~of~reef~area)), 
    y = expression(Density~of~Adult~Fish~(per~100~m^2~of~reef~area)),
    title = expression(Density~of~Spotted~Damselfish~Recruits~and~Adults~per~100~m^2~of~reef~area),
    color = "Lagoon",
    shape = "Year")+
  scale_color_manual(values = sanzo.duo("c091")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotted_all_plot

################# Yellow Damselfish (microhabitat = Mounding Coral) #################

yellow_recruit_density <- (yellow_recruit$number * moundingcoral$density_habitat)

yellow_all <- cbind(yellow_recruit_density, yellowdamselfish)

yellow_r2 <- yellow_all %>% 
  summarize(R2 = summary(lm(yellow_recruit_density ~ density))$r.squared)
# R2 = 0.401724

# Create XY scatter plot of density of recruits and adults
yellow_all_plot <- ggplot(yellow_all, aes(
                                          x = spotted_recruit_density, 
                                          y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Fish~Recruits~(per~100~m^2~of~reef~area)), 
    y = expression(Density~of~Adult~Fish~(per~100~m^2~of~reef~area)),
    title = expression(Density~of~Yellow~Damselfish~Recruits~and~Adults~per~100~m^2~of~reef~area),
    color = "Lagoon",
    shape = "Year")+
  scale_color_manual(values = sanzo.duo("c091")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

yellow_all_plot


```
Surgeonfish, Coral Trout, and Spotted Damselfish all show a strong position correlation in adult and recruit densities. Yellow Damselfish shows a weaker negative correlation in adult and recruit densities.

####4. Relationship between density of adults and density of microhabitat used by young

For each species of fish, make an â€˜XY Scatterâ€™ plot (with linear trend line and R-square value) of the relationship between density of adults and density of microhabitat used by their young. (You need to
make 4 different plots, 1 per fish species.) Which show a relationship? What are the trends?

```{r #4}

# Create XY scatter plot of density of adults and density of microhabitat used by their young

################# Surgeonfish vs fine-branching coral #################

surgeon_fine <- cbind(surgeonfish, finecoral$density_habitat)

surgeon_fine_r2 <- surgeon_fine %>% 
  summarize(R2 = summary(lm(density ~ `finecoral$density_habitat`))$r.squared)
# R2 = 0.9646357

surgeon_fine_plot <- ggplot(surgeon_fine, aes(x = finecoral$density_habitat, y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Young~Fish~Microhabitat~(1~m^2~per~100~m^2~of~reef~area)),
    y = expression(Density~of~Adult~Fish~(Number~per~100~m^2~of~reef)), 
    title = "Density of Adult Surgeonfish and Fine-branching Coral",
    color = "Lagoon",
    shape = "Year") +
  annotate(geom = "text", x = 1, y = 350, label = paste("R^2 ==", format(surgeon_fine_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c070")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeon_fine_plot

################# Coral Trout vs coarse-branching coral #################

coral_coarse <- cbind(coraltrout, coarsecoral$density_habitat)

coral_coarse_r2 <- coral_coarse %>% 
  summarize(R2 = summary(lm(density ~ `coarsecoral$density_habitat`))$r.squared)
# R2 = 0.7761476

coral_coarse_plot <- ggplot(coral_coarse, aes(x = coarsecoral$density_habitat, y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Young~Fish~Microhabitat~(1~m^2~per~100~m^2~of~reef~area)),
    y = expression(Density~of~Adult~Fish~(Number~per~100~m^2~of~reef)), 
    title = "Density of Adult Coral Trout and Coarse-branching Coral",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 1.25, y = 150, label = paste("R^2 ==", format(coral_coarse_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c070")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coral_coarse_plot

################# Spotted Damselfish vs sea anemones #################

spotted_anemone <- cbind(spotteddamselfish, anemone$density_habitat)

spotted_anemone_r2 <- spotted_anemone %>% 
  summarize(R2 = summary(lm(density ~ `anemone$density_habitat`))$r.squared)
# R2 = 0.9482483

spotted_anemone_plot <- ggplot(spotted_anemone, aes(x = anemone$density_habitat, y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Young~Fish~Microhabitat~(1~m^2~per~100~m^2~of~reef~area)),
    y = expression(Density~of~Adult~Fish~(Number~per~100~m^2~of~reef)), 
    title = "Density of Adult Spotted Damselfish and Sea Anemones",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 0.8, y = 875, label = paste("R^2 ==", format(spotted_anemone_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c070")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotted_anemone_plot

################# Yellow Damselfish vs mounding coral #################

yellow_mounding <- cbind(yellowdamselfish, moundingcoral$density_habitat)

yellow_mounding_r2 <- yellow_mounding %>% 
  summarize(R2 = summary(lm(density ~ `moundingcoral$density_habitat`))$r.squared)
# R2 = 0.0001074609

yellow_mounding_plot <- ggplot(yellow_mounding, aes(x = moundingcoral$density_habitat, y = density)) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  labs(
    x = expression(Density~of~Young~Fish~Microhabitat~(1~m^2~per~100~m^2~of~reef~area)),
    y = expression(Density~of~Adult~Fish~(Number~per~100~m^2~of~reef)), 
    title = "Density of Adult Yellow Damselfish and Mounding Coral",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 15, y = 85, label = paste("R^2 ==", format(yellow_mounding_r2, digits = 2)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c070")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

yellow_mounding_plot

```
Adult Surgeonfish and adult Spotted Damselfish show a strong positive correlation between their densities and their young's microhabitat (Fine-branching Coral and Sea Anemones, respectively) densities. Adult Coral Trout show a positive correlation between its density and its youn'g microhabitat (Coarse-branching Coral) density. These relationships indicate trends of increasing young fish microhabitat leading to increasing adult fish associated with that microhabitat. There is no significant correlation between adult Yellow Damselfish density and its young's microhabitat (Mounding Coral) density. This relationship indicates there is no trend associated with Mounding Coral and adult Yellow Damselfish.


####5. Density of adults per area of microhabitat used by young

For each species of fish, calculate for each year and lagoon the density of adults per area of bottom covered by the microhabitat used by the young. For each species of fish, make a histogram of the mean density of adults per area of juvenile microhabitat (use the same graphing method as in Question 1; you will need to make 4 different graphs, 1 per species of fish). Which species show apparent differences in the density of adults per area of juvenile microhabitat between Rarotonga and Aitutaki and between years? (Do not concern yourself with the 95% CI for these comparisons, just look to see which, if any, appear extremely different.) What are those trends?

```{r #5}

################# Surgeonfish #################

# Find density of adults/microhabitat (fine-branching coral)
surgeon_fine$adult_micro <- surgeon_fine$density/surgeon_fine$`finecoral$density_habitat`

surgeon_micro_plot <- ggplot(surgeon_fine, aes(x = location, y = adult_micro, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Fish~(per~100~m^2~of~Microhabitat)),
    title = "Density of Adult Surgeonfish per Fine-branching Coral Microhabitat Area") +
  scale_y_continuous(expand = c(0,0), limits = c(0,150)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c119"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(size = 12, hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeon_micro_plot  

################# Coral Trout #################

# Find density of adults/microhabitat (coarse-branching coral)
coral_coarse$adult_micro <- coral_coarse$density/coral_coarse$`coarsecoral$density_habitat`

coral_micro_plot <- ggplot(coral_coarse, aes(x = location, y = adult_micro, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Fish~(per~100~m^2~of~Microhabitat)),
    title = "Density of Adult Coral Trout per Coarse-branching Coral Microhabitat Area") +
  scale_y_continuous(expand = c(0,0), limits = c(0,55)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c119"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(size = 12, hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

coral_micro_plot  

################# Spotted Damselfish #################

# Find density of adults/microhabitat (sea anemones)
spotted_anemone$adult_micro <- spotted_anemone$density/spotted_anemone$`anemone$density_habitat`

spotted_micro_plot <- ggplot(spotted_anemone, aes(x = location, y = adult_micro, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Fish~(per~100~m^2~of~Microhabitat)),
    title = "Density of Adult Spotted Damselfish per Sea Anemone Microhabitat Area") +
  scale_y_continuous(expand = c(0,0), limits = c(0,550)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c119"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(size = 12, hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotted_micro_plot 

################# Yellow Damselfish #################

# Find density of adults/microhabitat (mounding coral)
yellow_mounding$adult_micro <- yellow_mounding$density/yellow_mounding$`moundingcoral$density_habitat`

yellow_micro_plot <- ggplot(yellow_mounding, aes(x = location, y = adult_micro, fill = location)) +
  geom_bar(stat = "identity", color = "black", position = "dodge", alpha = 0.9) +
  facet_wrap(~year) +
  labs(
    x = "Lagoon", 
    y = expression(Mean~Density~of~Adult~Fish~(per~100~m^2~of~Microhabitat)),
    title = "Density of Adult Yellow Damselfish per Mounding Coral Microhabitat Area") +
  scale_y_continuous(expand = c(0,0), limits = c(0,5.5)) +
  scale_x_discrete(expand = c(0,0)) +
  scale_fill_manual(values = (sanzo.duo("c119"))) +
  theme_bw() +
  theme(legend.position = "none") +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(size = 12, hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

yellow_micro_plot 

```
Between Rarotonga and Aitutaki, Surgeonfish and Coral Trout show apparent differences in the density of adults per area of juvenile microhabitat in both 2009 and 2018, with densities being lower in Rarotonga compared to Aitutaki. Spotted Damselfish show apparent differences in the density of adults per area of juvenile microhabitat in 2018, with densities being much lower in Rarotonga compared to Aitutaki, but densities are pretty similar between the two lagoons in 2009. Surgeonfish, Coral Trout, and Spotted Damselfish all show an apparent decrease in the density of adults per area of juvenile habitat in both lagoons between 2009 and 2018, with the largest decreases appearing in Rarotonga between 2009 and 2018 for both Coral Trout and Spotted Damselfish. Yellow Damselfish show an apparent increase in the density of adults per area of juvenile habitat in both lagoons between 2009 and 2018, although there isn't much difference between the two lagoons in both years.


####6. Compare densities of adults

For each pair of fish species, make an â€˜XY(Scatter)â€™ plot (with linear trend line and R-square value) for the densities of adults (i.e., plot the densities of one species against another; you need to make 6 different graphs). Which show patterns and what are those trends?

```{r #6}

################# Surgeonfish vs Coral Trout #################

# Add coral trout density to surgeonfish tibble
surgeon_trout <- cbind(surgeonfish, coraltrout$density)

# Find R2
surgeon_trout_r2 <- surgeon_trout %>% 
  summarize(R2 = summary(lm(density ~ `coraltrout$density`))$r.squared)
  # R2 = 0.3275856

surgeon_trout_plot <- ggplot(surgeon_trout, aes(x = density, y = `coraltrout$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Surgeonfish~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Coral~Trout~Density~(Number~per~100~m^2~of~reef)),
    title = "Surgeonfish and Coral Trout Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 100, y = 150, label = paste("R^2 ==", format(surgeon_trout_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeon_trout_plot

################# Surgeonfish vs Spotted Damselfish #################

# Add spotted damselfish density to surgeonfish tibble
surgeon_spotted <- cbind(surgeonfish, spotteddamselfish$density)

# Find R2
surgeon_spotted_r2 <- surgeon_spotted %>% 
  summarize(R2 = summary(lm(density ~ `spotteddamselfish$density`))$r.squared)
  # R2 = 0.410623

surgeon_spotted_plot <- ggplot(surgeon_spotted, aes(x = density, y = `spotteddamselfish$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Surgeonfish~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Spotted~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    title = "Surgeonfish and Spotted Damselfish Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 100, y = 750, label = paste("R^2 ==", format(surgeon_spotted_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeon_spotted_plot

################# Surgeonfish vs Yellow Damselfish #################

# Add yellow damselfish density to surgeonfish tibble
surgeon_yellow <- cbind(surgeonfish, yellowdamselfish$density)

# Find R2
surgeon_yellow_r2 <- surgeon_yellow %>% 
  summarize(R2 = summary(lm(density ~ `yellowdamselfish$density`))$r.squared)
  # R2 = 0.2015835

surgeon_yellow_plot <- ggplot(surgeon_yellow, aes(x = density, y = `yellowdamselfish$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Surgeonfish~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Yellow~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    title = "Surgeonfish and Yellow Damselfish Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 200, y = 85, label = paste("R^2 ==", format(surgeon_yellow_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

surgeon_yellow_plot

################# Coral Trout vs Spotted Damselfish #################

# Add spotted damselfish density to coral trout tibble
trout_spotted <- cbind(coraltrout, spotteddamselfish$density)

# Find R2
trout_spotted_r2 <- trout_spotted %>% 
  summarize(R2 = summary(lm(density ~ `spotteddamselfish$density`))$r.squared)
  # R2 = 0.9704437

trout_spotted_plot <- ggplot(trout_spotted, aes(x = density, y = `spotteddamselfish$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Coral~Trout~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Spotted~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    title = "Coral Trout and Spotted Damselfish Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 50, y = 750, label = paste("R^2 ==", format(trout_spotted_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

trout_spotted_plot

################# Coral Trout vs Yellow Damselfish #################

# Add yellow damselfish density to coral trout tibble
trout_yellow <- cbind(coraltrout, yellowdamselfish$density)

# Find R2
trout_yellow_r2 <- trout_yellow %>% 
  summarize(R2 = summary(lm(density ~ `yellowdamselfish$density`))$r.squared)
  # R2 = 0.8914587

trout_yellow_plot <- ggplot(trout_yellow, aes(x = density, y = `yellowdamselfish$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Coral~Trout~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Yellow~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    title = "Coral Trout and Yellow Damselfish Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 125, y = 80, label = paste("R^2 ==", format(trout_yellow_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

trout_yellow_plot

################# Spotted Damselfish vs Yellow Damselfish #################

# Add yellow damselfish density to spotted damselfish tibble
spotted_yellow <- cbind(spotteddamselfish, yellowdamselfish$density)

# Find R2
spotted_yellow_r2 <- spotted_yellow %>% 
  summarize(R2 = summary(lm(density ~ `yellowdamselfish$density`))$r.squared)
  # R2 = 0.7656169

spotted_yellow_plot <- ggplot(spotted_yellow, aes(x = density, y = `yellowdamselfish$density`)) +
  geom_point(size = 5, aes(color = location, shape = factor(year))) +
  geom_smooth(method = lm, se = F, color = "slategrey") +
  labs(
    x = expression(Adult~Spotted~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    y = expression(Adult~Yellow~Damselfish~Density~(Number~per~100~m^2~of~reef)),
    title = "Spotted Damselfish and Yellow Damselfish Densities",
    color = "Lagoon",
    shape = "Year")+
  annotate(geom = "text", x = 625, y = 80, label = paste("R^2 ==", format(spotted_yellow_r2, digits = 4)), color = "red4", family = "serif", parse = TRUE) +
  scale_color_manual(values = sanzo.duo("c114")) +
  theme_bw() +
  theme(text = element_text(family = "serif")) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

spotted_yellow_plot

```
When Yellow Damselfish density is compared to any other fish' density, the correlation is always negative.

